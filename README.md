# banana-accounting-custom-invoice

Alternative output for banana-accounting invoices.

## Problem

The banana-accounting extentions for printing invoices provide a stylesheet CSS
with a limited set of allowed commands. This reduces the options for
alternative layouts, especially if one is concerned to match the paragraph
formatting to the companies guidebook.

## How it works

<!-- markdownlint-disable MD033 -->
<p align="center" width="100%">
    <img
      alt="Overview"
      width="80%"
      src="https://raw.githubusercontent.com/romanrue/banana-accounting-custom-invoice/refs/heads/main/docs/overview.drawio.svg"
    />
</p>
<!-- markdownlint-enable MD033 -->

With the [banana-accounting API v2](https://www.banana.ch/doc/en/node/10022)
almost exclusively read requests only are allowed. This is why all the data must
be managed within the banana-accounting client.

One needs to select the newely created invoice from within this custom gui again.
This will launch a sequence, that reads out all the necessary data for the output
generation.

If it is possible to call an external program from within a banana-accounting
extension, the custom gui could be avoided and all the operations could be solved
with a direct banana-client to output dataflow.

### datafile.md

> [!WARNING]
> Subjected to change

The datafile defines some custom pandoc parameters in its yaml header. These
parameters are inserted to the `template` file before the output is generated by
pandoc.

An example datafile is given with [datafile.md](datafile.md).

## Roadmap

- [x] Implement `datafile.md` + `template.tex` to `output.pdf`chain
- [ ] Implent QR-code section in the `template.tex`
- [ ] Implement `datafile.md` + `template.docx` to `output.docx`chain
- [ ] Implement QR-code generation
- [ ] Implement banana-accounting web client server
- [ ] Implement gui

## Development

It is recommended to have [Nix](https://nixos.org/) and
[direnv](https://direnv.net/) installed and to allow
[Nix Flakes](https://nixos.wiki/wiki/Flakes).

The following command then ensures that the correct development environment with
all necessary dependencies is entered when inside of the project folder:

```bash
  direnv allow
```

### Output

To generate the `output.pdf` from the `datafile.md` and the `template.tex`, run:

```bash
  pandoc datafile.md -o output.pdf --template=template.tex --pdf-engine=xelatex
```

To continuously generate an `output.pdf` on file saves use:

```bash
  find ./ | entr -s 'pandoc datafile.md -o output.pdf --template=template.tex --pdf-engine=xelatex'
```
